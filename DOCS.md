# REST API

Things to know:
- For responses, `...` is not valid JSON, it indicates there are more results not shown to simplify output.
- For responses, the data is filler data, 0 means the data is of type `Number` while `""` means
  The data is of type `String`.
- Since Uber acquired Postmates, the API data seems to be the same for both. A search using both
  websites while monitoring the network tab in Chrome dev tools show the API endpoints have the
  same names. Additionally, the data returned is the same both on the website and with the 
  returned JSON data.

## Search

- Do not use this endpoint for autocompleting search results, use the autocomplete search endpoint
  instead (not yet completed).

### Usage example
```javascript
const options = {
  method: "GET",
  headers: {
    "Content-Type": "application/json",
  },
  body: JSON.stringify({
    query: "pizza",
  }),
};

fetch("localhost:8000/api/search", options)
  .then((response) => response.json())
  .then((response) => console.log(response))
  .catch((err) => console.error(err));
```

### Response example
```json
[
  {
    "service": "postmates",
    "stores": [
      {
        "id": "",
        "title": "",
        "location": { "latitude": 0, "longitude": 0 },
        "deliveryFee": 0,
        "estimatedDeliveryTime": 0,
        "rating": 0,
        "image": ""
      }
    ]
  },
  {"service": "grubhub", stores: [{},{},{}, ...]},
  ...
]
```

### Notes
- Errors that take place will replace the `stores` array with an `errors` object, an example can
  be found below:
  ```json
  [
   {
     "service": "postmates",
     "stores": [{},{},{}, ...]
   }
   {
     "service": "grubhub",
     "error": {status: 403, statusText: "Unauthorized"}
   },
   ...
  ]   
  ```
-  Refer to example response for types
- `estimatedDeliveryTime` is in minutes
- `deliveryFee` is in USD
- `rating` is out of 5 and depending on the platform it can be a float value
- `deliveryFee` seem to be promotional values ie: $0 on your first order, so they should not
   be used to calculate final costs.
- Some stores don't have ratings, if that's the case, a `null` rating will be returned
- Postmates uses a cookie that must be set in the browser prior to making the API call. This cookie can be retried using the `/set/location` endpoint. After this cookie has been set, it can be used to specify the location for all services (Postmates, Grubhub, and DoorDash).
- Doordash (Web API vs Mobile API)
  - Still doing research on the doordash mobile API tokens, they can be created, but compared to the
    tokens generated by the mobile app, tokens seem to be less stable (more rate limiting)
  - Compared to the web API, the mobile API does not provide location data for the
    search endpoint. But the mobile API is the better API to use since it allows location
    as part of the query, so we can search different locations. Here are some ideas if we need
    the location data from this endpoint (at the time of search):
      - Query both Web and Mobile endpoints and merge the data (this could be seen as a lot of queries to the Doordash API, resulting in their servers rate limiting us)
      - Make another call to get detailed information for all restaurants (same potential issue as above)
      - Pull the location data from another source like google maps API or something similar. 
- The following maps the supported JSON search parameters to each service. As APIs
  continue to be developed, more parameters will be supported.

  | Service         | query   | location | 
  | ----------------|---------|----------|
  | Postmates       |   ✅    |    ✅    |
  | Grubhub         |   ✅    |    ✅    |
  | DoorDash        |   ✅    |    ✅    |

## Autocomplete
  - The following are autocomplete APIs, these can be called repetitively for quick searches. The endpoints follow the format `/autocomplete/{specificAction}` ex: `/autocomplete/location` for auto completing location info or `autocomplete/search` for autocompleting service search results

### Autocomplete Location
  - The autocomplete location API wraps Postmates's/UberEats' Web autocomplete location API

 #### Usage Example:
 ```javascript
const url = "http://localhost:8000/api/autocomplete/location";

const options = {
  method: "GET",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ query: "los ang" }),
};

fetch(url, options)
  .then((res) => res.json())
  .then((json) => console.log(json))
  .catch((err) => console.error("error:" + err));
 ```

 #### Response Example:
 ```json
 [
   {
     "id": "c2523974-0f10-358d-8de9-8de58a6abcd1",
     "provider": "uber_places",
     "addressLine1": "Los Angeles International Airport (LAX)",
     "addressLine2": "1 World Way, Los Angeles"
   },
   {
     "id": "ChIJE9on3F3HwoAR9AhGJW_fL-I",
     "provider": "google_places",
     "addressLine1": "Los Angeles",
     "addressLine2": "CA, USA"
   },
   {
     "id": "72e67e9e-cb47-376c-f40e-df08fb63e1e6",
     "provider": "uber_places",
     "addressLine1": "Terminal 6",
     "addressLine2": "Gates 60 - 69, Los Angeles International Airport (LAX), Los Angeles"
   },
   {
     "id": "71124a11-c28a-3340-b39d-cd887ce01f52",
     "provider": "uber_places",
     "addressLine1": "Terminal 2",
     "addressLine2": "Gates 21 - 28, Los Angeles International Airport (LAX), Los Angeles"
   },
   {
     "id": "863e5e44-1bae-335b-b7bf-0474d7d7d484",
     "provider": "uber_places",
     "addressLine1": "Los Angeles Airport Marriott",
     "addressLine2": "5855 W Century Blvd, Los Angeles"
   }
 ]
 ```

- The above data can be passed into the `detail/location` api endpoint to get more detailed information about a location such as latitude and longitude info.

### Autocomplete Search
  - Not yet implemented

## Detail
  - The detail API endpoint can be used to get more detailed information for different subject matters such as restaurants and locations. The endpoint follows the format `detail/{subjectMatter}`. Ex: `detail/restaurant` to get detailed info about a specific restaurant or `detail/location` to get specific location about a location such as latitude and longitude data

### Restaurant
  - Not yet implemented

### Location
#### Usage Example:
```javascript
const url = "http://localhost:8000/api/detail/location";

const options = {
  method: "GET",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    locationData: {
      id: "c2523974-0f10-358d-8de9-8de58a6abcd1",
      provider: "uber_places",
      addressLine1: "Los Angeles International Airport (LAX)",
      addressLine2: "1 World Way, Los Angeles",
    },
  }),
};

fetch(url, options)
  .then((res) => res.json())
  .then((json) => console.log(json))
  .catch((err) => console.error("error:" + err));
```

- `LocationData` is an object that can be acquired using the `autocomplete/location` endpoint

#### Response Example
```json
{
  "address": {
    "address1": "Los Angeles International Airport (LAX)",
    "address2": "1 World Way, Los Angeles",
    "aptOrSuite": "",
    "eaterFormattedAddress": "1 World Way, Los Angeles, CA 90045, US",
    "subtitle": "1 World Way, Los Angeles",
    "title": "Los Angeles International Airport (LAX)",
    "uuid": ""
  },
  "latitude": 33.9431702,
  "longitude": -118.4001692,
  "reference": "c2523974-0f10-358d-8de9-8de58a6abcd1",
  "referenceType": "uber_places",
  "type": "uber_places",
  "source": "manual_auto_complete",
  "addressComponents": {
    "countryCode": "US",
    "firstLevelSubdivisionCode": "CA",
    "city": "Los Angeles",
    "postalCode": "90045"
  },
  "originType": "user_autocomplete"
}
```

## Set
  - The set API endpoint can be used to set values in the backend or retrieve data to be set in the frontend in the form of cookies.

### location
  - Set Postmates location to be used for searching. This endpoint does not return anything, but sets a cookie with the Postmates location data that must be sent back in a call's header to make use of that location for search results.

#### Usage Example
```javascript
const url = "http://localhost:8000/api/set/location";

const options = {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    locationDetails: {
      address: {
        address1: "Los Angeles International Airport (LAX)",
        address2: "1 World Way, Los Angeles",
        aptOrSuite: "",
        eaterFormattedAddress: "1 World Way, Los Angeles, CA 90045, US",
        subtitle: "1 World Way, Los Angeles",
        title: "Los Angeles International Airport (LAX)",
        uuid: "",
      },
      latitude: 33.9431702,
      longitude: -118.4001692,
      reference: "c2523974-0f10-358d-8de9-8de58a6abcd1",
      referenceType: "uber_places",
      type: "uber_places",
      source: "manual_auto_complete",
      addressComponents: {
        countryCode: "US",
        firstLevelSubdivisionCode: "CA",
        city: "Los Angeles",
        postalCode: "90045",
      },
      originType: "user_autocomplete",
    },
  }),
};

fetch(url, options)
  .then((res) => res.json())
  .then((json) => console.log(json))
  .catch((err) => console.error("error:" + err));

```

#### Response Example

